<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>6. Routes - Gestion des médias avec Cloudinary</title>
  <link rel="stylesheet" href="style.css" />
 kground: #f8f9fa; padding: 15px; border-radius: 5px; overflow-x: auto; }
  </style>
</head>
<body>
  <nav class="navbar">
    <ul>
      <li><a href="01-introduction.html">1. Introduction</a></li>
      <li><a href="02-dependances.html">2. Dépendances</a></li>
      <li><a href="03-config-env.html">3. Configuration & .env</a></li>
      <li><a href="04-middleware.html">4. Middleware</a></li>
      <li><a href="05-controller.html">5. Controller</a></li>
      <li><a href="06-routes.html" class="active">6. Routes</a></li>
      <li><a href="07-tests.html">7. Tests</a></li>
      <li><a href="08-multimedia.html">8. Multimédia</a></li>
    </ul>
  </nav>

  <main>
    <h1>Définition des routes pour l’upload et la gestion des médias</h1>

    <section>
      <h2>Structure de base des routes</h2>
      <p>Les routes sont responsables de connecter les requêtes HTTP aux middlewares et controllers appropriés.</p>
    </section>

    <section>
      <h2>Exemple simple de routes dans <code>routes/media.routes.js</code></h2>
      <pre><code>import express from 'express';
import upload from '../middlewares/upload.js';
import { uploadMedia, deleteMedia } from '../controllers/media.controller.js';

const router = express.Router();

// Route POST pour uploader un fichier (champ 'media')
router.post('/upload', upload.single('media'), uploadMedia);

// Route DELETE pour supprimer un média par public_id
router.delete('/delete/:public_id', deleteMedia);

export default router;
</code></pre>
    </section>
<section>
  <h2>Gestion des fichiers avec Multer : <code>upload.single()</code> vs <code>upload.array()</code></h2>
  
  <p>
    Dans l'exemple ci-dessus, la route POST utilise <code>upload.single('media')</code>. Cela signifie que Multer attend un seul fichier envoyé dans le champ nommé <code>media</code> du formulaire.
  </p>
  
  <h3>Que fait <code>upload.single('media')</code> ?</h3>
  <ul>
    <li>Il extrait un seul fichier depuis la requête HTTP dans le champ nommé <code>media</code>.</li>
    <li>Ce fichier est accessible ensuite dans <code>req.file</code> dans le controller.</li>
    <li>Si aucun fichier n’est envoyé ou si plusieurs fichiers sont envoyés, Multer ne traitera que le premier fichier pour ce champ.</li>
  </ul>
  
  <h3>Pour envoyer plusieurs fichiers à la fois</h3>
  <p>Si vous souhaitez autoriser l’upload de plusieurs fichiers simultanément, Multer propose deux méthodes :</p>
  
  <ol>
    <li>
      <code>upload.array(fieldname, maxCount)</code> : permet d’uploader plusieurs fichiers sous un même nom de champ (par exemple <code>photos</code>).<br />
      Les fichiers seront disponibles dans <code>req.files</code> (notez le pluriel).
    </li>
    <li>
      <code>upload.fields([{ name: 'media', maxCount: 3 }, { name: 'thumbnail', maxCount: 1 }])</code> : permet d’uploader plusieurs fichiers répartis dans différents champs du formulaire.
    </li>
  </ol>
  
  <h4>Exemple avec <code>upload.array</code> (dans <code>routes/media.routes.js</code>) :</h4>
  <pre><code>router.post('/upload-multiple', upload.array('media', 5), uploadMediaMultiple);</code></pre>
  
  <p>
    Ici, on attend jusqu’à 5 fichiers dans le champ <code>media</code>. Ces fichiers seront dans <code>req.files</code> et pourront être traités un par un dans le controller.
  </p>
  
  <h4>Exemple avec <code>upload.fields</code> :</h4>
  <pre><code>router.post('/upload-mixed', upload.fields([
  { name: 'media', maxCount: 3 },
  { name: 'thumbnail', maxCount: 1 }
]), uploadMixedMedia);</code></pre>
  
  <p>
    Ici, le formulaire peut envoyer jusqu’à 3 fichiers dans le champ <code>media</code> et 1 fichier dans <code>thumbnail</code>. 
    Dans le controller, on accède aux fichiers via <code>req.files['media']</code> et <code>req.files['thumbnail']</code>.
  </p>
  
  <h3>Résumé</h3>
  <ul>
    <li><code>upload.single('media')</code> : 1 fichier, accessible via <code>req.file</code></li>
    <li><code>upload.array('media', maxCount)</code> : plusieurs fichiers, accessibles via <code>req.files</code> (tableau)</li>
    <li><code>upload.fields([...])</code> : plusieurs fichiers répartis sur plusieurs champs, accessibles via <code>req.files[nomDuChamp]</code></li>
  </ul>
</section>

    <section>
      <h2>Intégration dans l’application principale</h2>
      <p>Dans <code>app.js</code> ou votre fichier principal :</p>
      <pre><code>import express from 'express';
import mediaRoutes from './routes/media.routes.js';

const app = express();

app.use('/media', mediaRoutes);

app.listen(3000, () => {
  console.log('Serveur démarré sur http://localhost:3000');
});
</code></pre>
    </section>

  </main>
</body>
</html>
