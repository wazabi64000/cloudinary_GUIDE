<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>7. Tests - Envoi de fichiers avec Postman (Cloudinary)</title>
  <link rel="stylesheet" href="style.css" />
 
</head>
<body>
  <nav class="navbar">
    <ul>
      <li><a href="01-introduction.html">1. Introduction</a></li>
      <li><a href="02-dependances.html">2. Dépendances</a></li>
      <li><a href="03-config-env.html">3. Configuration & .env</a></li>
      <li><a href="04-middleware.html">4. Middleware</a></li>
      <li><a href="05-controller.html">5. Controller</a></li>
      <li><a href="06-routes.html">6. Routes</a></li>
      <li><a href="07-tests.html" class="active">7. Tests</a></li>
      <li><a href="08-multimedia.html">8. Multimédia</a></li>
    </ul>
  </nav>

  <main>
    <h1>Tests manuels avec Postman</h1>

    <section>
      <h2>Objectif</h2>
      <p>Cette section explique comment tester l’upload de fichiers (images, vidéos...) vers Cloudinary via votre API grâce à <strong>Postman</strong> et le type <code>form-data</code>.</p>
    </section>

    <section>
      <h2>1. Test d’un upload simple avec Postman</h2>
      <ol>
        <li>Ouvrez <strong>Postman</strong></li>
        <li>Créez une requête <strong>POST</strong> vers votre endpoint, par exemple :
          <code>http://localhost:3000/media/upload</code>
        </li>
        <li>Allez dans l’onglet <strong>Body</strong></li>
        <li>Sélectionnez <strong>form-data</strong></li>
        <li>Ajoutez un champ :
          <ul>
            <li>Clé : <code>media</code> (doit correspondre à <code>upload.single('media')</code>)</li>
            <li>Type : <strong>File</strong></li>
            <li>Choisissez un fichier local à uploader (image, vidéo, PDF...)</li>
          </ul>
        </li>
        <li>Cliquez sur <strong>Send</strong></li>
      </ol>

      <p>Si tout fonctionne, vous recevrez une réponse <code>201</code> avec un objet JSON contenant l’URL du média stocké dans Cloudinary :</p>

      <pre><code>{
  "message": "Upload réussi",
  "data": {
    "url": "https://res.cloudinary.com/.../image/upload/v12345/xyz.jpg",
    "public_id": "xyz",
    "mimetype": "image/jpeg",
    "size": 234567
  }
}
</code></pre>
    </section>

    <section>
      <h2>2. Test d’un upload multiple</h2>
      <p>Si vous utilisez un middleware de type <code>upload.array('media', 5)</code> :</p>
      <ol>
        <li>Suivez la même procédure que ci-dessus, mais ajoutez plusieurs champs <strong>form-data</strong> avec la même clé : <code>media</code></li>
        <li>Pour chaque champ :
          <ul>
            <li>Sélectionnez le type <strong>File</strong></li>
            <li>Ajoutez un fichier différent</li>
          </ul>
        </li>
      </ol>

      <p>Votre controller recevra alors un tableau de fichiers dans <code>req.files</code>.</p>

      <p><strong>⚠️ Important :</strong> le nom de la clé (<code>media</code>) doit correspondre exactement à celui défini dans le middleware Multer.</p>
    </section>

    <section>
      <h2>3. Supprimer un média via Postman</h2>
      <p>Si vous avez une route <code>DELETE /media/delete/:public_id</code>, vous pouvez la tester ainsi :</p>
      <ol>
        <li>Utilisez une requête <strong>DELETE</strong></li>
        <li>L’URL doit contenir le <code>public_id</code> retourné lors de l’upload :
          <code>http://localhost:3000/media/delete/xyz</code>
        </li>
        <li>Cliquez sur <strong>Send</strong></li>
      </ol>
      <p>La réponse JSON doit confirmer la suppression :</p>
      <pre><code>{
  "message": "Fichier supprimé avec succès"
}</code></pre>
    </section>

    <section>
      <h2>Bonnes pratiques de test Postman</h2>
      <ul>
        <li>Utiliser toujours <strong>form-data</strong> pour envoyer des fichiers</li>
        <li>Bien définir les types des champs (<strong>File</strong> et non Text)</li>
        <li>Tester aussi les cas d’erreur : sans fichier, avec mauvais nom de champ, fichiers trop lourds, etc.</li>
      </ul>
    </section>

  </main>
</body>
</html>
